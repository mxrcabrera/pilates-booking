generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id                      String              @id @default(uuid())
  email                   String              @unique
  nombre                  String
  telefono                String?
  genero                  String              @default("F") @map("genero")
  password                String?
  emailVerified           DateTime?           @map("email_verified")
  image                   String?
  role                    UserRole            @default(PROFESOR)
  horasAnticipacionMinima Int                 @default(1) @map("horas_anticipacion_minima")
  maxAlumnosPorClase      Int                 @default(4) @map("max_alumnos_por_clase")
  horarioMananaInicio     String              @default("08:00") @map("horario_manana_inicio")
  horarioMananaFin        String              @default("14:00") @map("horario_manana_fin")
  horarioTardeInicio      String              @default("17:00") @map("horario_tarde_inicio")
  horarioTardeFin         String              @default("22:00") @map("horario_tarde_fin")
  espacioCompartidoId     String?             @map("espacio_compartido_id")
  syncGoogleCalendar      Boolean             @default(false) @map("sync_google_calendar")
  googleCalendarId        String?             @map("google_calendar_id")
  precioPorClase          Decimal             @default(0) @map("precio_por_clase") @db.Decimal(10, 2)
  createdAt               DateTime            @default(now()) @map("created_at")
  accounts                Account[]
  alumnos                 Alumno[]
  clases                  Clase[]
  horariosDisponibles     HorarioDisponible[]
  notificacionesRecibidas Notificacion[]
  packs                   Pack[]
  reservasComoAlumno      Reserva[]           @relation("AlumnoReservas")
  reservasComoProfesor    Reserva[]           @relation("ProfesorReservas")
  sessions                Session[]

  @@map("users")
}

model Pack {
  id              String   @id @default(uuid())
  profesorId      String   @map("profesor_id")
  nombre          String
  clasesPorSemana Int      @map("clases_por_semana")
  precio          Decimal  @db.Decimal(10, 2)
  estaActivo      Boolean  @default(true) @map("esta_activo")
  createdAt       DateTime @default(now()) @map("created_at")
  profesor        User     @relation(fields: [profesorId], references: [id], onDelete: Cascade)

  @@map("packs")
}

model Alumno {
  id                 String    @id @default(uuid())
  profesorId         String    @map("profesor_id")
  nombre             String
  email              String
  telefono           String
  cumpleanos         DateTime? @map("cumpleanos") @db.Date
  patologias         String?   @map("patologias")
  packType           String    @map("pack_type")
  clasesPorMes       Int?      @map("clases_por_mes")
  precio             Decimal   @db.Decimal(10, 2)
  estaActivo         Boolean   @default(true) @map("esta_activa")
  estaPausada        Boolean   @default(false) @map("esta_pausada")
  syncGoogleCalendar Boolean   @default(false) @map("sync_google_calendar")
  googleCalendarId   String?   @map("google_calendar_id")
  createdAt          DateTime  @default(now()) @map("created_at")
  genero             String    @default("F") @map("genero")
  consentimientoTutor Boolean  @default(false) @map("consentimiento_tutor")
  profesor           User      @relation(fields: [profesorId], references: [id], onDelete: Cascade)
  clases             Clase[]
  pagos              Pago[]

  @@map("alumnos")
}

model HorarioDisponible {
  id         String   @id @default(uuid())
  profesorId String   @map("profesor_id")
  diaSemana  Int      @map("dia_semana")
  horaInicio String   @map("hora_inicio")
  horaFin    String   @map("hora_fin")
  esManiana  Boolean  @map("es_maniana")
  estaActivo Boolean  @default(true) @map("esta_activo")
  createdAt  DateTime @default(now()) @map("created_at")
  profesor   User     @relation(fields: [profesorId], references: [id], onDelete: Cascade)

  @@map("horarios_disponibles")
}

model Clase {
  id                String   @id @default(uuid())
  profesorId        String   @map("profesor_id")
  alumnoId          String?  @map("alumno_id")
  fecha             DateTime @db.Date
  horaInicio        String   @map("hora_inicio")
  horaRecurrente    String?  @map("hora_recurrente")
  esRecurrente      Boolean  @default(false) @map("es_recurrente")
  frecuenciaSemanal Int?     @map("frecuencia_semanal")
  diasSemana        Int[]    @map("dias_semana")
  estado            String   @default("reservada")
  esClasePrueba     Boolean  @default(false) @map("es_clase_prueba")
  googleEventId     String?  @map("google_event_id")
  createdAt         DateTime @default(now()) @map("created_at")
  alumno            Alumno?  @relation(fields: [alumnoId], references: [id])
  profesor          User     @relation(fields: [profesorId], references: [id], onDelete: Cascade)

  @@map("clases")
}

model Pago {
  id                 String    @id @default(uuid())
  alumnoId           String    @map("alumno_id")
  monto              Decimal   @db.Decimal(10, 2)
  fechaPago          DateTime? @map("fecha_pago") @db.Date
  fechaVencimiento   DateTime  @map("fecha_vencimiento") @db.Date
  estado             String    @default("pendiente")
  mesCorrespondiente String    @map("mes_correspondiente")
  createdAt          DateTime  @default(now()) @map("created_at")
  alumno             Alumno    @relation(fields: [alumnoId], references: [id], onDelete: Cascade)

  @@map("pagos")
}

model Account {
  id                String  @id @default(cuid())
  userId            String  @map("user_id")
  type              String
  provider          String
  providerAccountId String  @map("provider_account_id")
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique @map("session_token")
  userId       String   @map("user_id")
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model VerificationToken {
  identifier String
  token      String
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

model Reserva {
  id             String         @id @default(uuid())
  alumnoUserId   String         @map("alumno_user_id")
  profesorId     String         @map("profesor_id")
  fecha          DateTime       @db.Date
  horaInicio     String         @map("hora_inicio")
  horaFin        String         @map("hora_fin")
  estado         String         @default("confirmada")
  notasAlumno    String?        @map("notas_alumno")
  createdAt      DateTime       @default(now()) @map("created_at")
  canceladaEn    DateTime?      @map("cancelada_en")
  notificaciones Notificacion[]
  alumnoUser     User           @relation("AlumnoReservas", fields: [alumnoUserId], references: [id], onDelete: Cascade)
  profesor       User           @relation("ProfesorReservas", fields: [profesorId], references: [id], onDelete: Cascade)

  @@map("reservas")
}

model Notificacion {
  id           String           @id @default(uuid())
  userId       String           @map("user_id")
  tipo         NotificationType
  titulo       String
  mensaje      String
  leida        Boolean          @default(false)
  reservaId    String?          @map("reserva_id")
  emailEnviado Boolean          @default(false) @map("email_enviado")
  createdAt    DateTime         @default(now()) @map("created_at")
  reserva      Reserva?         @relation(fields: [reservaId], references: [id])
  user         User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notificaciones")
}

enum UserRole {
  PROFESOR
  ALUMNO
}

enum NotificationType {
  RESERVA_NUEVA
  RESERVA_CANCELADA
  CLASE_MODIFICADA
  CLASE_CANCELADA
  RECORDATORIO_CLASE
}
